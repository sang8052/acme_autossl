import{h as l,d,i as r,j as c}from"./api-9463a482.js";import{n as _,A as p,S as h}from"./index-20699720.js";var u=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("t-card",{staticClass:"list-card-container",staticStyle:{height:"780px"},attrs:{bordered:""}},[e("t-row",{attrs:{justify:"space-between"}},[e("t-col",{attrs:{span:8}},[e("div",{staticStyle:{width:"100%"}},[e("t-select",{staticStyle:{width:"250px",float:"left"},attrs:{clearable:"",onChange:t.load_domain_list,options:t.dns_api,placeholder:"请选择API秘钥"},model:{value:t.search.key_id,callback:function(i){t.$set(t.search,"key_id",i)},expression:"search.key_id"}}),e("t-input",{staticStyle:{width:"250px",float:"left","margin-left":"16px"},attrs:{placeholder:"请输入搜索关键字",onChange:t.load_domain_list,clearable:""},on:{clear:function(i){t.item_keyword=""}},scopedSlots:t._u([{key:"suffixIcon",fn:function(){return[e("search-icon",{style:{cursor:"pointer"}})]},proxy:!0}]),model:{value:t.search.keyword,callback:function(i){t.$set(t.search,"keyword",i)},expression:"search.keyword"}})],1)]),e("t-col",{attrs:{span:4}},[e("t-button",{staticStyle:{float:"right","margin-top":"4px"},attrs:{type:"button"},on:{click:function(i){return t.on_create_domain()}}},[e("add-icon",{attrs:{slot:"icon"},slot:"icon"}),t._v(" 新增域名 ")],1)],1)],1),e("div",{staticClass:"table-container",staticStyle:{height:"666px","margin-top":"16px"}},[e("t-table",{attrs:{rowKey:"id",columns:t.columns,data:t.data,loading:t.data_loading},scopedSlots:t._u([{key:"action",fn:function(i){var n=i.row;return[e("t-link",{attrs:{theme:"primary"},on:{click:function(s){return t.on_detail(n,"view")}}},[t._v("详情")]),e("t-link",{attrs:{theme:"danger"},on:{click:function(s){return t.on_detail(n,"delete")}}},[t._v("删除")])]}}])})],1),e("t-pagination",{attrs:{showPageSize:!1,total:t.page_total,defaultPageSize:t.page_size,defaultCurrent:t.page_num},on:{change:t.on_pagination_change}})],1),e("t-dialog",{attrs:{visible:t.display_detail,header:t.header_title,top:"48px",width:"720px"},on:{"update:visible":function(i){t.display_detail=i}}},[e("t-form",{ref:"DomainDetail",staticStyle:{"margin-top":"16px"},attrs:{data:t.domain_detail,labelWidth:"150px",rules:t.form_rules}},[e("t-form-item",{attrs:{label:"根域名",name:"domain"}},[e("t-input",{attrs:{placeholder:"请输入根域名",readonly:t.dialog_type=="view"},model:{value:t.domain_detail.domain,callback:function(i){t.$set(t.domain_detail,"domain",i)},expression:"domain_detail.domain"}})],1),e("t-form-item",{attrs:{label:"API秘钥",name:"key_id"}},[e("t-select",{attrs:{clearable:"",options:t.dns_api,placeholder:"请选择API秘钥"},model:{value:t.domain_detail.key_id,callback:function(i){t.$set(t.domain_detail,"key_id",i)},expression:"domain_detail.key_id"}})],1)],1),e("div",{staticStyle:{"margin-top":"-16px"},attrs:{slot:"footer"},slot:"footer"},[t.dialog_type=="create"?e("t-button",{attrs:{type:"button",theme:"primary",loading:t.btn_loading},on:{click:function(i){return t.on_submit()}}},[t._v("新增")]):t._e(),t.dialog_type=="create"?e("t-button",{attrs:{type:"button",theme:"default",loading:t.btn_loading},on:{click:function(i){return t.on_close()}}},[t._v("取消")]):t._e()],1)],1)],1)},m=[];const f={components:{AddIcon:p,SearchIcon:h},data(){return{page_num:1,page_size:10,page_total:0,search:{keyword:"",key_id:""},columns:[{colKey:"domain",title:"根域名",width:250,fixed:"left",ellipsis:!0,align:"left"},{colKey:"key_name",title:"秘钥名称",width:150,fixed:"left",ellipsis:!0,align:"left"},{colKey:"key_type",title:"秘钥类型",width:150,fixed:"left",ellipsis:!0,align:"left"},{colKey:"action",title:"操作",align:"left",fixed:"right",width:300}],data:[],data_loading:!1,display_detail:!1,header_title:"",dialog_type:"",btn_loading:!1,domain_detail:{},dns_api:[],form_rules:{key_id:[{required:!0,message:"请选择API秘钥",type:"error"}],domain:[{required:!0,message:"根域名必填",type:"error"}]}}},created(){this.load_dnsapi_list(),this.load_domain_list()},methods:{async load_dnsapi_list(){const t=await l({page_num:1,page_size:999});this.dns_api=[],t.data.data.forEach(a=>{const e={label:a.key_name,value:a.id};this.dns_api.push(e)})},async load_domain_list(){this.data_loading=!0;const t={keyword:this.search.keyword,page_num:this.page_num,page_size:this.page_size,key_id:this.search.key_id},a=await d(t);this.data=a.data.data,this.data_loading=!1,this.page_num=a.data.page_num,this.page_size=a.data.page_size,this.page_total=a.data.total},on_create_domain(){this.$refs.DomainDetail.reset(),this.header_title="新建域名",this.dialog_type="create",this.display_detail=!0,this.load_dnsapi_list()},on_pagination_change(t){this.page_num=t.current,this.page_size=t.pageSize,this.load_domain_list()},async on_detail(t,a){if(a==="delete"){const e=this.$dialog.confirm({header:"提示",body:"此操作不可逆,确认执行?",confirmBtn:"确定",cancelBtn:"取消",onConfirm:async()=>{(await r(t.id)).code===0&&(this.$message.success("删除域名信息成功!"),this.on_close()),e.hide()},onClose:async()=>{e.hide()}})}else this.domain_detail=t,this.display_detail=!0,this.dialog_type=a,this.header_title="查看域名信息"},on_close(){this.load_domain_list(),this.display_detail=!1},async on_submit(){if(typeof await this.$refs.DomainDetail.validate()=="boolean"){const a={...this.domain_detail};this.btn_loading=!0;const e=await c(a);e.code===0&&this.$message.success(e.msg),this.btn_loading=!1,this.on_close()}}}},o={};var y=_(f,u,m,!1,g,null,null,null);function g(t){for(let a in o)this[a]=o[a]}const b=function(){return y.exports}();export{b as default};
