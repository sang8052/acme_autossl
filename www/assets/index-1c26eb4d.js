import{n as r,A as d,S as c,l as n}from"./index-20699720.js";import{h as _,k as p,l as y,m as u,n as h,o as m}from"./api-9463a482.js";var f=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("t-card",{staticClass:"list-card-container",staticStyle:{height:"780px"},attrs:{bordered:""}},[t("t-row",{attrs:{justify:"space-between"}},[t("t-col",{attrs:{span:8}},[t("div",{staticStyle:{width:"100%"}},[t("t-select",{staticStyle:{width:"250px",float:"left"},attrs:{label:"秘钥类型:",clearable:"",options:e.system_support,placeholder:"请选择秘钥类型",onChange:e.load_dnsapi_list},model:{value:e.search.key_type,callback:function(s){e.$set(e.search,"key_type",s)},expression:"search.key_type"}}),t("t-input",{staticStyle:{width:"250px",float:"left","margin-left":"16px"},attrs:{placeholder:"请输入搜索关键字",onChange:e.load_dnsapi_list,clearable:""},on:{clear:function(s){e.item_keyword=""}},scopedSlots:e._u([{key:"suffixIcon",fn:function(){return[t("search-icon",{style:{cursor:"pointer"}})]},proxy:!0}]),model:{value:e.search.keyword,callback:function(s){e.$set(e.search,"keyword",s)},expression:"search.keyword"}})],1)]),t("t-col",{attrs:{span:4}},[t("t-button",{staticStyle:{float:"right","margin-top":"4px"},attrs:{type:"button"},on:{click:function(s){return e.on_create_key()}}},[t("add-icon",{attrs:{slot:"icon"},slot:"icon"}),e._v(" 添加API秘钥 ")],1)],1)],1),t("div",{staticClass:"table-container",staticStyle:{height:"666px","margin-top":"16px"}},[t("t-table",{attrs:{rowKey:"id",columns:e.columns,data:e.data,loading:e.data_loading},scopedSlots:e._u([{key:"action",fn:function(s){var i=s.row;return[t("t-link",{attrs:{theme:"primary"},on:{click:function(l){return e.on_detail(i,"view")}}},[e._v("详情")]),t("t-link",{attrs:{theme:"warning"},on:{click:function(l){return e.on_detail(i,"edit")}}},[e._v("修改")]),t("t-link",{attrs:{theme:"danger"},on:{click:function(l){return e.on_detail(i,"delete")}}},[e._v("删除")])]}}])})],1),t("t-pagination",{attrs:{showPageSize:!1,total:e.page_total,defaultPageSize:e.page_size,defaultCurrent:e.page_num},on:{change:e.on_pagination_change}})],1),t("t-dialog",{attrs:{visible:e.display_detail,header:e.header_title,top:"48px",width:"720px"},on:{"update:visible":function(s){e.display_detail=s}}},[t("t-form",{ref:"ApiDetail",staticStyle:{"margin-top":"16px"},attrs:{data:e.api_detail,labelWidth:"150px",rules:e.form_rules}},[t("t-form-item",{attrs:{label:"秘钥名称",name:"key_name"}},[t("t-input",{attrs:{placeholder:"请输入秘钥名称",readonly:e.dialog_type=="view"},model:{value:e.api_detail.key_name,callback:function(s){e.$set(e.api_detail,"key_name",s)},expression:"api_detail.key_name"}})],1),t("t-form-item",{attrs:{label:"秘钥类型",name:"key_name"}},[t("t-select",{attrs:{clearable:"",options:e.system_support,placeholder:"请选择秘钥类型"},model:{value:e.api_detail.key_type,callback:function(s){e.$set(e.api_detail,"key_type",s)},expression:"api_detail.key_type"}})],1),t("t-form-item",{attrs:{label:"AccessId",name:"access_id"}},[t("t-input",{attrs:{placeholder:"请输入秘钥的AccessId",readonly:e.dialog_type=="view"},model:{value:e.api_detail.access_id,callback:function(s){e.$set(e.api_detail,"access_id",s)},expression:"api_detail.access_id"}})],1),t("t-form-item",{attrs:{label:"AccessKey",name:"access_key"}},[t("t-input",{attrs:{placeholder:"请输入秘钥的AccessKey",readonly:e.dialog_type=="view"},model:{value:e.api_detail.access_key,callback:function(s){e.$set(e.api_detail,"access_key",s)},expression:"api_detail.access_key"}})],1)],1),t("div",{staticStyle:{"margin-top":"-16px"},attrs:{slot:"footer"},slot:"footer"},[e.dialog_type=="create"?t("t-button",{attrs:{type:"button",theme:"primary",loading:e.btn_loading},on:{click:function(s){return e.on_submit()}}},[e._v("新增")]):e._e(),e.dialog_type=="edit"?t("t-button",{attrs:{type:"button",theme:"primary",loading:e.btn_loading},on:{click:function(s){return e.on_submit()}}},[e._v("保存")]):e._e(),e.dialog_type!="view"?t("t-button",{attrs:{type:"button",theme:"default",loading:e.btn_loading},on:{click:function(s){return e.on_close()}}},[e._v("取消")]):e._e()],1)],1)],1)},g=[];const k={components:{AddIcon:d,SearchIcon:c},data(){return{page_num:1,page_size:10,page_total:0,data:[],data_loading:!1,btn_loading:!1,columns:[{colKey:"key_name",title:"秘钥名称",width:150,fixed:"left",ellipsis:!0,align:"center"},{colKey:"key_type",title:"秘钥类型",width:150,fixed:"left",ellipsis:!0,align:"center"},{colKey:"access_id",title:"AccessId",width:250,fixed:"left",ellipsis:!0,align:"left"},{colKey:"access_key",title:"AccessKey",width:250,fixed:"left",ellipsis:!0,align:"left"},{colKey:"action",title:"操作",align:"left",fixed:"right",width:300}],search:{keyword:"",key_type:""},system_support:[],header_title:"",display_detail:!1,api_detail:{id:"",key_name:"",key_type:"",access_id:"",access_key:""},dialog_type:"",form_rules:{key_name:[{required:!0,message:"秘钥名称必填",type:"error"}],key_type:[{required:!0,message:"秘钥类型必选",type:"error"}],access_id:[{required:!0,message:"AccessId必填",type:"error"}],access_key:[{required:!0,message:"AccessKey必填",type:"error"}]}}},created(){this.load_system_suport(),this.load_dnsapi_list()},methods:{async load_dnsapi_list(){this.data_loading=!0;const e={keyword:this.search.keyword,key_type:this.search.key_type,page_num:this.page_num,page_size:this.page_size},a=await _(e);n.success("拉取dnsapi 列表成功",a.data),this.data=a.data.data,this.data_loading=!1,this.page_num=a.data.page_num,this.page_size=a.data.page_size,this.page_total=a.data.total},async load_system_suport(){const e=await p();this.system_support=[],e.data.forEach(a=>{const t={label:a.name,value:a.api_keyword};this.system_support.push(t)}),n.success("拉取系统支持的dns_api 成功",this.system_support)},on_pagination_change(e){this.page_num=e.current,this.page_size=e.pageSize,this.load_dnsapi_list()},on_create_key(){this.display_detail=!0,this.header_title="新增API秘钥",this.$refs.ApiDetail.reset(),this.dialog_type="create"},on_close(){this.load_dnsapi_list(),this.display_detail=!1},async on_detail(e,a){if(a==="delete"){const t=this.$dialog.confirm({header:"提示",body:"此操作不可逆,确认执行?",confirmBtn:"确定",cancelBtn:"取消",onConfirm:async()=>{(await y(e.id)).code===0&&(this.$message.success("删除API秘钥成功!"),this.on_close()),t.hide()},onClose:async()=>{t.hide()}})}else{const t=await u(e.id);this.api_detail=t.data,this.display_detail=!0,this.dialog_type=a,a==="edit"?this.header_title="编辑API秘钥":this.header_title="查看API秘钥"}},async on_submit(){if(typeof await this.$refs.ApiDetail.validate()=="boolean"){if(this.dialog_type==="create"){const a={...this.api_detail};this.btn_loading=!0;const t=await h(a);t.code===0&&this.$message.success(t.msg),this.btn_loading=!1,this.on_close()}if(this.dialog_type==="edit"){const a={...this.api_detail};this.btn_loading=!0;const t=await m(a.id,a);t.code===0&&this.$message.success(t.msg),this.btn_loading=!1,this.on_close()}}}}},o={};var v=r(k,f,g,!1,b,null,null,null);function b(e){for(let a in o)this[a]=o[a]}const $=function(){return v.exports}();export{$ as default};
