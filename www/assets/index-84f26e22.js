import{V as p,_ as f,u as m,I as d,a as _,L as k,B as D,b as S,n as w}from"./index-20699720.js";import{u as j,a as C}from"./api-9463a482.js";var I=["size"];function y(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);s&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function h(e){for(var s=1;s<arguments.length;s++){var t=arguments[s]!=null?arguments[s]:{};s%2?y(Object(t),!0).forEach(function(r){_(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):y(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var M={tag:"svg",attrs:{fill:"none",viewBox:"0 0 24 24",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M1 3h22v18H1V3zm2 2v1.83l9 4.55 9-4.55V5H3zm18 4.07l-9 4.55-9-4.55V19h18V9.07z"}}]},R=p.extend({name:"MailIcon",functional:!0,props:{size:{type:String},onClick:{type:Function}},render:function(s,t){var r=t.props,n=t.data,a=r.size,i=f(r,I),o=m(a),c=o.className,l=o.style,u=h(h({},i||{}),{},{id:"mail",icon:M,staticClass:c,style:l});return n.props=u,s(d,n)}});const E=R;var F=["size"];function v(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);s&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function g(e){for(var s=1;s<arguments.length;s++){var t=arguments[s]!=null?arguments[s]:{};s%2?v(Object(t),!0).forEach(function(r){_(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):v(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var L={tag:"svg",attrs:{fill:"none",viewBox:"0 0 24 24",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M12 3a9 9 0 100 18 9 9 0 000-18zM1 12a11 11 0 1122 0 11 11 0 01-22 0zm8-4v4H7V8h2zm8 0v4h-2V8h2zm-5 6c-.36 0-1 .45-1 1.5s.64 1.5 1 1.5 1-.45 1-1.5-.64-1.5-1-1.5zm-3 1.5c0-1.71 1.15-3.5 3-3.5s3 1.79 3 3.5-1.15 3.5-3 3.5-3-1.79-3-3.5z"}}]},T=p.extend({name:"Surprised1Icon",functional:!0,props:{size:{type:String},onClick:{type:Function}},render:function(s,t){var r=t.props,n=t.data,a=r.size,i=f(r,F),o=m(a),c=o.className,l=o.style,u=g(g({},i||{}),{},{id:"surprised-1",icon:L,staticClass:c,style:l});return n.props=u,s(d,n)}});const q=T;var N=["size"];function b(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);s&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function O(e){for(var s=1;s<arguments.length;s++){var t=arguments[s]!=null?arguments[s]:{};s%2?b(Object(t),!0).forEach(function(r){_(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):b(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var U={tag:"svg",attrs:{fill:"none",viewBox:"0 0 24 24",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M12 4a3.5 3.5 0 100 7 3.5 3.5 0 000-7zM6.5 7.5a5.5 5.5 0 1111 0 5.5 5.5 0 01-11 0zM3 19a5 5 0 015-5h8a5 5 0 015 5v3H3v-3zm5-3a3 3 0 00-3 3v1h14v-1a3 3 0 00-3-3H8z"}}]},V=p.extend({name:"UserIcon",functional:!0,props:{size:{type:String},onClick:{type:Function}},render:function(s,t){var r=t.props,n=t.data,a=r.size,i=f(r,N),o=m(a),c=o.className,l=o.style,u=O(O({},i||{}),{},{id:"user",icon:U,staticClass:c,style:l});return n.props=u,s(d,n)}});const z=V,B={username:[{required:!0,message:"账号必填",type:"error"}],password:[{required:!0,message:"密码必填",type:"error"}]},A=p.extend({name:"Login",components:{UserIcon:z,LockOnIcon:k,BrowseOffIcon:D,BrowseIcon:S},data(){return{FORM_RULES:B,type:"password",formData:{username:"",password:""},showPsw:!1,countDown:0,intervalTimer:null,btn_loading:!1}},beforeDestroy(){clearInterval(this.intervalTimer)},methods:{switchType(e){this.type=e,this.$refs.form.reset()},async onSubmit({validateResult:e}){if(e===!0){this.btn_loading=!0;const s=await j({username:this.formData.username,password:this.formData.password});s.code===0&&(this.$message.success("登录成功"),window.localStorage.setItem("user_session",JSON.stringify(s.data)),window.localStorage.setItem("user_session_id",s.data.session_id),await this.$store.dispatch("socketio/close_socket"),await this.$store.dispatch("socketio/init_socket"),this.$router.push({path:"/admin"})),this.btn_loading=!1}},handleCounter(){this.countDown=60,this.intervalTimer=setInterval(()=>{this.countDown>0?this.countDown-=1:(clearInterval(this.intervalTimer),this.countDown=0)},1e3)}}});var H=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("t-form",{ref:"form",class:["item-container",`login-${e.type}`],attrs:{data:e.formData,rules:e.FORM_RULES,"label-width":"0"},on:{submit:e.onSubmit}},[e.type=="password"?[t("t-form-item",{attrs:{name:"account"}},[t("t-input",{attrs:{size:"large",placeholder:"请输入账号"},scopedSlots:e._u([{key:"prefix-icon",fn:function(){return[t("user-icon")]},proxy:!0}],null,!1,2615955785),model:{value:e.formData.username,callback:function(r){e.$set(e.formData,"username",r)},expression:"formData.username"}})],1),t("t-form-item",{attrs:{name:"password"}},[t("t-input",{key:"password",attrs:{size:"large",type:e.showPsw?"text":"password",clearable:"",placeholder:"请输入登录密码"},scopedSlots:e._u([{key:"prefix-icon",fn:function(){return[t("lock-on-icon")]},proxy:!0},{key:"suffix-icon",fn:function(){return[e.showPsw?t("browse-icon",{key:"browse",on:{click:function(r){e.showPsw=!e.showPsw}}}):t("browse-off-icon",{key:"browse-off",on:{click:function(r){e.showPsw=!e.showPsw}}})]},proxy:!0}],null,!1,1306754401),model:{value:e.formData.password,callback:function(r){e.$set(e.formData,"password",r)},expression:"formData.password"}})],1)]:e._e(),e.type!=="qrcode"?t("t-form-item",{staticClass:"btn-container"},[t("t-button",{attrs:{block:"",loading:e.btn_loading,size:"large",type:"submit"}},[e._v(" 登录 ")])],1):e._e()],2)},K=[];const P={};var J=w(A,H,K,!1,W,null,null,null);function W(e){for(let s in P)this[s]=P[s]}const Y=function(){return J.exports}(),G={mail_address:"",password_verify:"",password:"",username:"",nickname:""},Q={username:[{required:!0,message:"请输入您的用户名",type:"error"}],nickname:[{required:!0,message:"请输入您的昵称",type:"error"}],mail_address:[{required:!0,email:!0,message:"邮箱地址格式不正确",type:"error"}],password:[{required:!0,message:"请输入您的密码,长度不小于8位",len:8,type:"error"}]},X=p.extend({name:"Register",components:{UserIcon:z,MailIcon:E,BrowseIcon:S,BrowseOffIcon:D,LockOnIcon:k,Surprised1Icon:q},data(){return{FORM_RULES:Q,formData:{...G},showPsw:!1,showPsw_verify:!1,btn_loading:!1}},methods:{async onSubmit({validateResult:e}){if(e===!0)if(this.formData.password!==this.formData.password_verify)this.message.error("两次输入的密码不一致!");else{this.btn_loading=!0;const s=await C(this.formData);s.code===0?(this.$message.success("注册成功,请重新登陆!"),this.$emit("reg_success")):this.$message.error(s.msg),this.btn_loading=!1}}}});var Z=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("t-form",{ref:"form",class:["item-container",`register-${e.type}`],attrs:{data:e.formData,rules:e.FORM_RULES,"label-width":"0"},on:{submit:e.onSubmit}},[t("t-form-item",{attrs:{name:"email"}},[t("t-input",{attrs:{type:"text",size:"large",placeholder:"请输入您的用户名"},scopedSlots:e._u([{key:"prefix-icon",fn:function(){return[t("user-icon")]},proxy:!0}]),model:{value:e.formData.username,callback:function(r){e.$set(e.formData,"username",r)},expression:"formData.username"}})],1),t("t-form-item",{attrs:{name:"password"}},[t("t-input",{attrs:{size:"large",type:e.showPsw?"text":"password",clearable:"",placeholder:"请输入登录密码"},scopedSlots:e._u([{key:"prefix-icon",fn:function(){return[t("lock-on-icon")]},proxy:!0},{key:"suffix-icon",fn:function(){return[e.showPsw?t("browse-icon",{key:"browse",on:{click:function(r){e.showPsw=!e.showPsw}}}):t("browse-off-icon",{key:"browse-off",on:{click:function(r){e.showPsw=!e.showPsw}}})]},proxy:!0}]),model:{value:e.formData.password,callback:function(r){e.$set(e.formData,"password",r)},expression:"formData.password"}})],1),t("t-form-item",{attrs:{name:"password_verify"}},[t("t-input",{attrs:{size:"large",type:e.showPsw?"text":"password",clearable:"",placeholder:"请再次输入一遍密码"},scopedSlots:e._u([{key:"prefix-icon",fn:function(){return[t("lock-on-icon")]},proxy:!0},{key:"suffix-icon",fn:function(){return[e.showPsw?t("browse-icon",{key:"browse",on:{click:function(r){e.showPsw_verify=!e.showPsw_verify}}}):t("browse-off-icon",{key:"browse-off",on:{click:function(r){e.showPsw_verify=!e.showPsw_verify}}})]},proxy:!0}]),model:{value:e.formData.password_verify,callback:function(r){e.$set(e.formData,"password_verify",r)},expression:"formData.password_verify"}})],1),t("t-form-item",{attrs:{name:"nickname"}},[t("t-input",{attrs:{type:"text",size:"large",placeholder:"请输入您的昵称"},scopedSlots:e._u([{key:"prefix-icon",fn:function(){return[t("surprised1-icon")]},proxy:!0}]),model:{value:e.formData.nickname,callback:function(r){e.$set(e.formData,"nickname",r)},expression:"formData.nickname"}})],1),t("t-form-item",{attrs:{name:"mail_address"}},[t("t-input",{attrs:{type:"text",size:"large",placeholder:"请输入您的邮箱,用于接收证书签发状态通知"},scopedSlots:e._u([{key:"prefix-icon",fn:function(){return[t("mail-icon")]},proxy:!0}]),model:{value:e.formData.mail_address,callback:function(r){e.$set(e.formData,"mail_address",r)},expression:"formData.mail_address"}})],1),t("t-form-item",[t("t-button",{attrs:{block:"",loading:e.btn_loading,size:"large",type:"submit"}},[e._v(" 注册 ")])],1)],1)},ee=[];const x={};var te=w(X,Z,ee,!1,re,null,null,null);function re(e){for(let s in x)this[s]=x[s]}const se=function(){return te.exports}();var ne=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"login-wrapper"},[t("div",{staticClass:"login-container"},[t("div",{staticClass:"title-container"},[t("h1",{staticClass:"title margin-no"},[e._v("登录到")]),t("h1",{staticClass:"title"},[e._v("Acme_AutoSSL 签发中心")]),t("div",{staticClass:"sub-title"},[t("p",{staticClass:"tip"},[e._v(e._s(e.type=="register"?"已有账号?":"没有账号吗?"))]),t("p",{staticClass:"tip",on:{click:function(r){return e.switchType(e.type=="register"?"login":"register")}}},[e._v(" "+e._s(e.type=="register"?"登录":"注册新账号")+" ")])])]),e.type==="login"?t("login"):t("register",{on:{reg_success:function(r){return e.switchType("login")}}})],1),t("footer",{staticClass:"copyright"},[e._v("Copyright @ 2020-"+e._s(new Date().getFullYear())+" atonal.cn. All Rights Reserved")])])},oe=[];const ae={name:"LoginIndex",components:{Login:Y,Register:se},data(){return{type:"login"}},mounted(){const e=this.$route.query.type;e?this.type=e:this.type="login",window.sessionStorage.removeItem("handle_user_unlogin")},methods:{switchType(e){this.$router.push({path:"/login",query:{type:e}}),this.type=e}}},$={};var ie=w(ae,ne,oe,!1,ce,null,null,null);function ce(e){for(let s in $)this[s]=$[s]}const pe=function(){return ie.exports}();export{pe as default};
